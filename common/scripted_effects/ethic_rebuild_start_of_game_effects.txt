
generate_start_pops = {
	if = {
		limit = {
			owner = {
				has_origin = origin_machine_cult
				NOT = { has_valid_civic = civic_machine_soul_servant }
			}
		}
		owner = {
			create_built_robot_species = yes
		}
		while = {
			count = 8
			create_pop = {
				species = last_created_species
			}
		}
		add_building = building_mecha_monastery
		remove_building = building_temple
		while = {
			limit = {
				num_pops < 27
			}
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_machine_cult
				has_valid_civic = civic_machine_soul_servant
			}
		}
		owner = {
			create_built_robot_species = yes
		}
		while = {
			count = 5
			create_pop = {
				species = last_created_species
			}
		}
		add_building = building_mecha_monastery
		add_building = building_mechanical_sanctuary
		remove_building = building_temple
		while = {
			limit = {
				num_pops < 33
			}
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				OR = {
					has_origin = origin_syncretic_evolution
					has_origin = origin_symbiotic_race
					has_origin = origin_slave_race
					has_origin = origin_necrophage
					has_valid_civic = civic_machine_servitor
					has_valid_civic = civic_machine_assimilator
					has_valid_civic = civic_machine_financial_investment
				}
			}
		}

		if = { limit = { last_created_species = { is_species_class = MACHINE } }
			modify_species = {
				species = last_created_species
				add_trait = trait_machine_unit
				add_traits_at_start_of_list = yes
			}
			last_created_species = { save_event_target_as = last_created_species }
		}

		if = {
			limit = {
				owner = {
					OR = {
						has_origin = origin_syncretic_evolution
						has_origin = origin_necrophage
					    has_origin = origin_symbiotic_race
					    has_origin = origin_slave_race
					}
				}
			}

			last_created_species = {
				set_species_flag = syncretic_species@root.owner
				if = {
					limit = {
						prev.owner = {
							has_origin = origin_syncretic_evolution
					    	has_origin = origin_symbiotic_race
					    	has_origin = origin_slave_race
						}
					}
					set_citizenship_type = {
						country = root.owner
						type = citizenship_slavery
					}
				}
			}
			if = {
				limit = {
					owner = {
						has_origin = origin_necrophage
						OR = {
							has_valid_civic = civic_fanatic_purifiers
							has_valid_civic = civic_hive_devouring_swarm
							is_gestalt = yes
						}
					}
				}
				while = {
					count = 6
					create_pop = {
						species = last_created_species
						ethos = random
					}
				}
			}
			else_if = {
				limit = {
					owner = {
						has_origin = origin_necrophage
						is_gestalt = yes
					}
				}
				while = {
					count = 9
					create_pop = {
						species = last_created_species
						ethos = random
					}
				}
			}
			else = {
				while = {
					count = 12
					create_pop = {
						species = last_created_species
						ethos = random
					}
				}
			}
		}

		if = {
			limit = {
				owner = { has_valid_civic = civic_machine_servitor }
			}
			last_created_species = {
				if = {
					limit = {
						ROOT = { is_planet_class = pc_shattered_ring_habitable }
					}
					modify_species = {
						species = this
						ideal_planet_class = home_planet
					}
				}
				set_citizenship_type = {
					country = root.owner
					type = citizenship_limited
				}
				set_living_standard = {
					country = root.owner
					type = living_standard_organic_trophy
				}
			}
			while = {
				count = 5
				create_pop = {
					species = last_created_species
					ethos = random
				}
				last_created_pop = {
					clear_ethos = yes
				}
			}
		}

		if = {
			limit = {
				owner = {
					has_valid_civic = civic_machine_servitor
					has_origin = origin_true_yuht
				}
			}
			last_created_species = {
				if = {
					limit = {
						ROOT = { is_planet_class = pc_shattered_ring_habitable }
					}
					modify_species = {
						species = this
						ideal_planet_class = home_planet
					}
				}
				set_citizenship_type = {
					country = root.owner
					type = citizenship_limited
				}
				set_living_standard = {
					country = root.owner
					type = living_standard_organic_trophy
				}
			}
			while = {
				count = 10
				create_pop = {
					species = last_created_species
					ethos = random
				}
				last_created_pop = {
					clear_ethos = yes
				}
			}
		}

		if = {
			limit = {
				owner = { has_valid_civic = civic_machine_assimilator }
			}
			last_created_species = {
				if = {
					limit = {
						ROOT = { is_planet_class = pc_shattered_ring_habitable }
					}
					modify_species = {
						species = this
						ideal_planet_class = home_planet
					}
				}
				set_citizenship_type = {
					country = root.owner
					type = citizenship_full_machine
				}
				set_living_standard = {
					country = root.owner
					type = living_standard_hive_mind
				}
			}
			while = {
				count = 10
				create_pop = {
					species = last_created_species
					ethos = random
				}
				last_created_pop = {
					clear_ethos = yes
				}
			}
		}

		if = {
			limit = {
				owner = { has_valid_civic = civic_machine_financial_investment }
			}
			last_created_species = {
				if = {
					limit = {
						ROOT = { is_planet_class = pc_shattered_ring_habitable }
					}
					modify_species = {
						species = this
						ideal_planet_class = home_planet
					}
				}
			}
			while = {
				count = 5
				create_pop = {
					species = last_created_species
					ethos = random
				}
				last_created_pop = {
					clear_ethos = yes
				}
			}
		}
	}

	if = {
		limit = { owner = { has_origin = origin_mechanists } }
		owner = {
			create_built_robot_species = yes
		}
		while = {
			count = 8
			create_pop = {
				species = last_created_species
			}
		}
		every_owned_pop = {
			limit = {
				has_job = miner
				is_robotic_species = yes
			}
			modify_species = {
				species = this
				add_trait = trait_robot_power_drills
				add_trait = trait_robot_bulky
				add_trait = trait_robot_high_maintenance
				add_traits_at_start_of_list = yes
			}
		}
		every_owned_pop = {
			limit = {
				has_job = farmer
				is_robotic_species = yes
			}
			modify_species = {
				species = this
				add_trait = trait_robot_harvesters
				add_trait = trait_robot_bulky
				add_trait = trait_robot_high_maintenance
				add_traits_at_start_of_list = yes
			}
		}
		every_owned_pop = {
			limit = {
				has_job = technician
				is_robotic_species = yes
			}
			modify_species = {
				species = this
				add_trait = trait_robot_superconductive
				add_trait = trait_robot_bulky
				add_trait = trait_robot_high_maintenance
				add_traits_at_start_of_list = yes
			}
		}

		add_building = building_robot_assembly_plant
		add_district_and_planet_size_if_needed_effect = {
			district = district_generator
		}
		while = {
			limit = { num_pops < 27 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_necrophage
				NOR = { #purges them instead
					has_civic = civic_fanatic_purifiers
					has_civic = civic_hive_devouring_swarm
				}
			}
		}
		if = {
			limit = {
				owner = { has_valid_civic = civic_agrarian_idyll } # Needs an extra building slot
			}
			add_district_and_planet_size_if_needed_effect = {
				district = district_city
			}
		}

		add_building = building_necrophage_elevation_chamber
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_clone_army
			}
		}
		add_building = building_clone_army_clone_vat
		add_building = building_clone_army_clone_vat
		planet_event = { id = clones.10 days = 1095 random = 730 }
	}
	if = {
		limit = { owner = { is_hive_empire = yes } }
		while = {
			limit = { num_pops < 33 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = { owner = { has_valid_civic = civic_machine_servitor } }
		while = {
			limit = { num_pops < 33 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = { owner = { is_machine_empire = yes } }
		while = {
			limit = { num_pops < 29 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				is_megacorp = yes
				has_reduced_pop_origin = no
			}
		}
		while = {
			limit = { num_pops < 28 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_broken_shackles }
			num_pops < 6
		}

		while = {
			limit = { num_pops < 6 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				is_regular_empire = yes
				has_reduced_pop_origin = no
			}
		}
		while = {
			limit = { num_pops < 28 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_payback }
			num_pops < 18
		}
		while = {
			limit = { num_pops < 18 }
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_fear_of_the_dark }
		}
		while = {
			count = 20
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = { #homicidal necrophages lose 1/4 of their necrophytes to fleeing
			owner = {
				has_origin = origin_necrophage
				is_homicidal = yes
			}
		}
		while = {
			count = 2
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_default }
		}
		while = {
			count = 4
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_true_yuht
				NOT = { has_valid_civic = civic_machine_servitor }
			}
		}
		while = {
			count = 67
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_true_yuht
				has_valid_civic = civic_machine_servitor
			}
		}
		while = {
			count = 52
			create_pop = {
				species = root.owner.species
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_thirteen_monkeys }
		}
		while = {
			count = 30
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = { is_eager_explorer_empire = yes }
		}
		while = {
			count = 10
			random_owned_pop = {
				limit = {
					is_same_species = root.owner.species
				}
				kill_pop = yes
			}
		}
	}
	if = {
		limit = {
			owner = { has_origin = origin_taking_care_of_god }
		}
		while = {
			count = 12
			create_pop = {
				species = owner_main_species
				ethos = random
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_taking_care_of_god
			}
		}
		while = {
			count = 13
			random_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_fallen_god
					add_traits_at_start_of_list = yes
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_civic = civic_permanent_employment	
			}
		}
		while = {
			count = 4
			random_owned_pop = {
				limit = {
					OR = {
						has_job = clerk
						has_job = technician
						has_job = miner
						has_job = farmer
					}
					is_robotic_species = no
				}
				modify_species = {
					species = this
					add_trait = trait_zombie
					add_traits_at_start_of_list = yes
				}
				if = {
					limit = {
						has_trait = trait_syncretic_proles
					}
					modify_species = {
						species = this
						remove_trait = trait_syncretic_proles
					}	
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_civic = civic_corpus	
			}
		}
		add_building = building_nuumismatic_shrine
		remove_building = building_temple
		while = {
			count = 4
			random_owned_pop = {
				limit = {
					OR = {
						has_job = clerk
						has_job = technician
						has_job = miner
						has_job = farmer
					}
					is_robotic_species = no
				}
				modify_species = {
					species = this
					add_trait = trait_flesh_components
					add_traits_at_start_of_list = yes
				}
				if = {
					limit = {
						has_trait = trait_syncretic_proles
					}
					modify_species = {
						species = this
						remove_trait = trait_syncretic_proles
					}	
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_civic = civic_libido_equipment	
			}
		}
		add_building = building_equipment_breeding_plant
	}
}

generate_home_planet_final_pass = {
	optimize_memory
	# Adjust life-seeded colonies
	if = {
		limit = {
			owner = {
				has_origin = origin_life_seeded
			}
		}

		owner = {
			# Nuke other colonies gained from advanced empire, etc
			every_owned_planet = {
				limit = { is_capital = no }
				remove_all_buildings = yes
				destroy_colony = yes
			}
			if = {
				limit = { NOT = { has_valid_civic = civic_permanent_employment } }
				change_dominant_species = { species = last_created_species change_all = yes }
			}
		}
	}
	if = {
		limit = {
			owner = {
				OR = {
					has_origin = origin_shattered_ring
					has_origin = origin_machine
				}
			}
		}
		owner = {
			capital_scope = {
				system_star = {
					set_deposit = d_energy_10
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_tree_of_life
			}
		}
		owner = {
			capital_scope = {
				add_deposit = d_tree_of_life_home
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_lithoid
			}
		}
		owner = {
			capital_scope = {
				add_deposit = d_lithoid_crater
				add_deposit = d_buried_lithoids
				add_deposit = d_buried_lithoids
				add_deposit = d_buried_lithoids
				add_deposit = d_buried_lithoids
				add_modifier = { modifier = lithoid_crater }
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_lost_colony
			}
		}
		owner = {
			capital_scope = {
				add_modifier = { modifier = colonial_spirit_mod }
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_broken_shackles
			}
		}
		owner = {
			capital_scope = {
				add_modifier = { modifier = free_at_last_broken_shackles days = 7200 }
				add_modifier = { modifier = culture_shock_broken_shackles days = 3600 }
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_progenitor_hive
			}
		}
		owner = {
			capital_scope = {
				add_deposit = d_progenitor
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_default
			}
		}
		owner = {
			if = {
				limit = {
					is_gestalt = no
				}
				capital_scope = {
					add_modifier = { modifier = prosp_uni_mod days = 7200 }
				}
			}
			else = {
				capital_scope = {
					add_modifier = { modifier = prosp_uni_mod_gestalt days = 7200 }
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				OR = {
					has_origin = origin_machine
					has_origin = origin_true_yuht
				}
			}
		}
		owner = {
			capital_scope = {
				add_deposit = d_machine_minerals
				solar_system = {
					every_system_planet = {
						limit = {
							colonizable_planet = no
							is_star = no
						}
						clear_deposits = yes
					}
					every_system_planet = {
						limit = {
							is_asteroid = yes
						}
						remove_planet = yes
					}
					every_system_planet = {
						limit = {
							colonizable_planet = no
							is_star = no
							is_asteroid = no
							NOT = { is_planet_class = pc_gas_giant }
						}
						change_pc = pc_broken
					}
					every_system_planet = {
						limit = {
							colonizable_planet = no
							is_star = no
							is_planet_class = pc_gas_giant
						}
						change_pc = pc_molten
						add_modifier = { modifier = chthonian_planet }
						every_moon = {
							limit = {
								colonizable_planet = no
							}
							remove_planet = yes
						}
						while = {
							limit = {
								planet_size >= 20
							}
							change_planet_size = -6
						}
					}
				}
			}
		}
	}
	if = {
		limit = {
			owner = {
				any_owned_pop = {
					has_trait = trait_exotic_metabolism
				}
			}
		}

		add_deposit = d_exotic_mountain
	}
}

#红色起源
red_origin_start_effect = {
	# Main Backup
	if = { # Backup if the main system hasn't already been initialized
		limit = {
			NOT = { exists = event_target:origin_red_homeland_country }
		}
		# Find a random system, hopefully close to a player with the origin
		random_system = {
			limit = {
				has_owner = no
				has_special_star_flag_trigger = no
			}
			weights = {
				base = 1
				modifier = {
					factor = 100
					closest_system = {
						use_bypasses = no
						min_steps = 2
						max_steps = 4
						limit = {
							has_owner = yes
							owner = {
								has_origin = origin_red_satellite
							}
						}
					}
				}
			}
			# Start Spawning Systems
			set_spawn_system_batch = begin
			red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_init }
			# Main Empire
			event_target:origin_red_homeland.solar_system = {
				red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_2_init }
				red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_3_init }
			}
			# Vassals
			event_target:red_homeland_2.solar_system = { red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_4_init } }
			if = {
				limit = {
					NOT = {
						galaxy_size = tiny
					}
				}
				event_target:red_homeland_2.solar_system = { red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_5_init } }
			}
			if = {
				limit = {
					NOR = {
						galaxy_size = tiny
						galaxy_size = small
					}
				}
				event_target:red_homeland_3.solar_system = { red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_6_init } }
			}
			if = {
				limit = {
					NOR = {
						galaxy_size = tiny
						galaxy_size = small
						galaxy_size = medium
					}
				}
				event_target:red_homeland_3.solar_system = { red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_7_init } }
			}
			set_spawn_system_batch = end

			# Set up hyperlanes if they are missing
			red_origin_start_hyperlane_effect = {
				ORIGINAL_STAR_SYSTEM = event_target:red_homeland_2.solar_system
				SECOND_STAR_SYSTEM = event_target:origin_red_homeland.solar_system
			}
			red_origin_start_hyperlane_effect = {
				ORIGINAL_STAR_SYSTEM = event_target:red_homeland_3.solar_system
				SECOND_STAR_SYSTEM = event_target:origin_red_homeland.solar_system
			}
			red_origin_start_hyperlane_effect = {
				ORIGINAL_STAR_SYSTEM = event_target:red_homeland_4.solar_system
				SECOND_STAR_SYSTEM = event_target:red_homeland_2.solar_system
			}
			if = {
				limit = {
					exists = event_target:red_homeland_5
				}
				red_origin_start_hyperlane_effect = {
					ORIGINAL_STAR_SYSTEM = event_target:red_homeland_5.solar_system
					SECOND_STAR_SYSTEM = event_target:red_homeland_2.solar_system
				}
			}
			if = {
				limit = {
					exists = event_target:red_homeland_6
				}
				red_origin_start_hyperlane_effect = {
					ORIGINAL_STAR_SYSTEM = event_target:red_homeland_6.solar_system
					SECOND_STAR_SYSTEM = event_target:red_homeland_3.solar_system
				}
			}
			if = {
				limit = {
					exists = event_target:red_homeland_7
				}
				red_origin_start_hyperlane_effect = {
					ORIGINAL_STAR_SYSTEM = event_target:red_homeland_7.solar_system
					SECOND_STAR_SYSTEM = event_target:red_homeland_3.solar_system
				}
			}
		}
	}
	else_if = {
		limit = { # Backup if any of the other main empire systems are missing
			OR = {
				NOT = { any_system = { has_star_flag = soviet_union_system_2_flag } }
				NOT = { any_system = { has_star_flag = soviet_union_system_3_flag } }
			}
		}
		event_target:origin_red_homeland.solar_system = {
			red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_2_init }
			red_origin_start_spawn_effect = { INITIALIZER = soviet_union_system_3_init }
			red_origin_start_hyperlane_effect = {
				ORIGINAL_STAR_SYSTEM = event_target:red_homeland_2.solar_system
				SECOND_STAR_SYSTEM = event_target:origin_red_homeland.solar_system
			}
			red_origin_start_hyperlane_effect = {
				ORIGINAL_STAR_SYSTEM = event_target:red_homeland_3.solar_system
				SECOND_STAR_SYSTEM = event_target:origin_red_homeland.solar_system
			}
		}
	}

	# Vassal Backup
	if = { # Backup for vassal 1
		limit = {
			any_system = { has_star_flag = soviet_union_system_2_flag }
			NOT = { any_system = { has_star_flag = soviet_union_system_4_flag } }
		}
		red_origin_vassal_backup_effect = {
			SYSTEM_FLAG = soviet_union_system_2_flag
			INITIALIZER = soviet_union_system_4_init
			ORIGINAL_STAR_SYSTEM = event_target:red_homeland_4.solar_system
		}
	}
	if = { # Backup for vassal 2
		limit = {
			any_system = { has_star_flag = soviet_union_system_2_flag }
			NOR = {
				galaxy_size = tiny
				any_system = { has_star_flag = soviet_union_system_5_flag }
			}
		}
		red_origin_vassal_backup_effect = {
			SYSTEM_FLAG = soviet_union_system_2_flag
			INITIALIZER = soviet_union_system_5_init
			ORIGINAL_STAR_SYSTEM = event_target:red_homeland_5.solar_system
		}
	}
	if = { # Backup for vassal 3
		limit = {
			any_system = { has_star_flag = soviet_union_system_3_flag }
			NOR = {
				galaxy_size = tiny
				galaxy_size = small
				any_system = { has_star_flag = soviet_union_system_6_flag }
			}
		}
		red_origin_vassal_backup_effect = {
			SYSTEM_FLAG = soviet_union_system_3_flag
			INITIALIZER = soviet_union_system_6_init
			ORIGINAL_STAR_SYSTEM = event_target:red_homeland_6.solar_system
		}
	}
	if = { # Backup for vassal 4
		limit = {
			any_system = { has_star_flag = soviet_union_system_3_flag }
			NOR = {
				galaxy_size = tiny
				galaxy_size = small
				galaxy_size = medium
				any_system = { has_star_flag = soviet_union_system_7_flag }
			}
		}
		red_origin_vassal_backup_effect = {
			SYSTEM_FLAG = soviet_union_system_3_flag
			INITIALIZER = soviet_union_system_7_init
			ORIGINAL_STAR_SYSTEM = event_target:red_homeland_7.solar_system
		}
	}

	# Modifier to reduce influence
	event_target:origin_red_homeland_country = {
		add_modifier = {
			modifier = imperial_vassal_ai_modifier
			days = -1
		}
	}

	# Rival Country
	if = {
		limit = {
			OR = {
				AND = {
					is_multiplayer = yes
					NOT = {
						count_country = {
							count >= 2
							limit = {
								is_ai = no
								has_origin = origin_red_satellite
							}
						}
					}
				}
				is_multiplayer = no
			}
		}
		random_country = {
			limit = {
				is_ai = yes
				has_origin = origin_red_satellite
			}
			set_country_flag = origin_red_satellite_rival_country
		}
	}

	# Startup event for vassals
	every_playable_country = {
		limit = { has_origin = origin_red_satellite }
		country_event = { id = red_origin.5700 }
		if = {
			limit = {
				always = yes
			}
			country_event = {
				id = red_origin.5703
				days = 1
			}
		}
		else = {
			country_event = { id = red_origin.5710 }
		}
	}
	every_country = {
		limit = {
			is_ai = yes
			has_origin = origin_red_satellite
		}
		country_event = { id = red_origin.5711 }
	}
}

red_origin_start_hyperlane_effect = {
	if = {
		limit = {
			NOT = {
				$ORIGINAL_STAR_SYSTEM$ = {
					has_hyperlane_to = $SECOND_STAR_SYSTEM$
				}
			}
		}
		add_hyperlane = {
			from = $ORIGINAL_STAR_SYSTEM$
			to = $SECOND_STAR_SYSTEM$
		}
	}
}

red_origin_start_spawn_effect = {
	spawn_system = {
		min_distance = 10
		max_distance = 30
		max_jumps = 0
		hyperlane = yes
		initializer = $INITIALIZER$
	}
}

red_origin_vassal_backup_effect = {
	random_system = {
		limit = {
			has_star_flag = $SYSTEM_FLAG$
		}
		save_event_target_as = this_system

		red_origin_start_spawn_effect = { INITIALIZER = $INITIALIZER$ }
		red_origin_start_hyperlane_effect = {
			ORIGINAL_STAR_SYSTEM = $ORIGINAL_STAR_SYSTEM$
			SECOND_STAR_SYSTEM = event_target:this_system
		}
	}
}

#开局科技
give_physics_tech_tier_1_effect = {
	give_technology = { message = no tech = tech_basic_science_lab_2 }
	give_technology = { message = no tech = tech_space_science_1 }
	give_technology = { message = no tech = tech_space_science_2 }
	give_technology = { message = no tech = tech_physics_1 }
	give_technology = { message = no tech = tech_administrative_ai }
	give_technology = { message = no tech = tech_cryostasis_1 }
	give_technology = { message = no tech = tech_automated_exploration }
	give_technology = { message = no tech = tech_combat_computers_1 }
	give_technology = { message = no tech = tech_auxiliary_fire_control }
	give_technology = { message = no tech = tech_encryption_1 }
	give_technology = { message = no tech = tech_decryption_1 }
	give_technology = { message = no tech = tech_fusion_power }
	give_technology = { message = no tech = tech_reactor_boosters_2 }
	give_technology = { message = no tech = tech_reactor_boosters_3 }
	give_technology = { message = no tech = tech_shields_2 }
	give_technology = { message = no tech = tech_power_plant_2 }
	give_technology = { message = no tech = tech_power_hub_1 }
	give_technology = { message = no tech = tech_lasers_2 }
}

give_physics_tech_tier_2_effect = {
	give_technology = { message = no tech = tech_curator_lab }
	if = {
		limit = {
			has_ancrel = yes
		}
		give_technology = { message = no tech = tech_archeology_lab_ancrel }
	}
	else = {
		give_technology = { message = no tech = tech_archeology_lab }
	}
	give_technology = { message = no tech = tech_space_science_3 }
	give_technology = { message = no tech = tech_space_science_4 }
	give_technology = { message = no tech = tech_physics_2 }
	give_technology = { message = no tech = tech_self_aware_logic }
	if = {
		limit = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_consumer_good_refinement_1 }
	}
	give_technology = { message = no tech = tech_encryption_2 }
	give_technology = { message = no tech = tech_decryption_2 }
	give_technology = { message = no tech = tech_cold_fusion_power }
	give_technology = { message = no tech = tech_shields_3 }
	give_technology = { message = no tech = tech_shield_rechargers_1 }
	give_technology = { message = no tech = tech_sensors_2 }
	give_technology = { message = no tech = tech_power_plant_3 }
	give_technology = { message = no tech = tech_power_hub_2 }
	if = {
		limit = {
			NOT = { has_origin = origin_true_yuht }
		}
		give_technology = { message = no tech = tech_hyper_drive_2 }
	}
	give_technology = { message = no tech = tech_ftl_inhibitor }
	give_technology = { message = no tech = tech_lasers_3 }
	give_technology = { message = no tech = tech_pd_tracking_2 }
	give_technology = { message = no tech = tech_mine_volatile_motes }
}

give_physics_tech_tier_3_effect = {
	give_technology = { message = no tech = tech_space_science_5 }
	give_technology = { message = no tech = tech_combat_computers_2 }
	give_technology = { message = no tech = tech_encryption_3 }
	give_technology = { message = no tech = tech_decryption_3 }
	give_technology = { message = no tech = tech_antimatter_power }
	give_technology = { message = no tech = tech_reactor_boosters_3 }
	give_technology = { message = no tech = tech_shields_4 }
	give_technology = { message = no tech = tech_planetary_shield_generator }
	give_technology = { message = no tech = tech_sensors_3 }
	give_technology = { message = no tech = tech_power_plant_4 }
	give_technology = { message = no tech = tech_mine_dark_matter }
	give_technology = { message = no tech = tech_lasers_4 }
}

give_engineering_tech_tier_1_effect = {
	give_technology = { message = no tech = tech_corvette_build_speed }
	give_technology = { message = no tech = tech_corvette_hull_1 }
	give_technology = { message = no tech = tech_strike_craft_1 }
	give_technology = { message = no tech = tech_ship_armor_2 }
	give_technology = { message = no tech = tech_powered_exoskeletons }
	give_technology = { message = no tech = tech_space_mining_1 }
	give_technology = { message = no tech = tech_space_mining_2 }
	give_technology = { message = no tech = tech_mining_1 }
	give_technology = { message = no tech = tech_mineral_purification_1 }
	give_technology = { message = no tech = tech_alloys_1 }
	give_technology = { message = no tech = tech_luxuries_1 }
	give_technology = { message = no tech = tech_engineering_1 }
	give_technology = { message = no tech = tech_robotic_workers }
	give_technology = { message = no tech = tech_afterburners_1 }
	give_technology = { message = no tech = tech_assembly_pattern }
	give_technology = { message = no tech = tech_mass_drivers_2 }
	give_technology = { message = no tech = tech_missiles_2 }
}

give_engineering_tech_tier_2_effect = {
	give_technology = { message = no tech = tech_destroyers }
	give_technology = { message = no tech = tech_corvette_hull_2 }
	give_technology = { message = no tech = tech_destroyer_build_speed }
	give_technology = { message = no tech = tech_destroyer_hull_1 }
	give_technology = { message = no tech = tech_starbase_3 }
	give_technology = { message = no tech = tech_modular_engineering }
	give_technology = { message = no tech = tech_strike_craft_2 }
	give_technology = { message = no tech = tech_ship_armor_3 }
	give_technology = { message = no tech = tech_crystal_armor_1 }
	give_technology = { message = no tech = tech_thrusters_2 }
	give_technology = { message = no tech = tech_defense_platform_hull_1 }
	give_technology = { message = no tech = tech_space_mining_3 }
	give_technology = { message = no tech = tech_space_mining_4 }
	give_technology = { message = no tech = tech_mining_2 }
	give_technology = { message = no tech = tech_mineral_purification_2 }
	give_technology = { message = no tech = tech_advanced_metallurgy_1 }
	give_technology = { message = no tech = tech_engineering_2 }
	give_technology = { message = no tech = tech_droid_workers }
	give_technology = { message = no tech = tech_housing_1 }
	give_technology = { message = no tech = tech_mass_drivers_3 }
	give_technology = { message = no tech = tech_missiles_3 }
	give_technology = { message = no tech = tech_flak_batteries_2 }
	give_technology = { message = no tech = tech_mine_rare_crystals }
	give_technology = { message = no tech = tech_mine_exotic_gases }
}

give_engineering_tech_tier_3_effect = {
	if = {
		limit = {
			OR = {
				is_machine_empire = no
				has_civic = civic_machine_assimilator
			}
		}
		give_technology = { message = no tech = tech_integrated_cybernetics }
	}
	give_technology = { message = no tech = tech_cruisers }
	give_technology = { message = no tech = tech_destroyer_hull_2 }
	give_technology = { message = no tech = tech_cruiser_build_speed }
	give_technology = { message = no tech = tech_cruiser_hull_1 }
	give_technology = { message = no tech = tech_starbase_4 }
	give_technology = { message = no tech = tech_habitat_1 }
	give_technology = { message = no tech = tech_strike_craft_3 }
	give_technology = { message = no tech = tech_ship_armor_4 }
	give_technology = { message = no tech = tech_thrusters_3 }
	give_technology = { message = no tech = tech_space_mining_5 }
	give_technology = { message = no tech = tech_mining_3 }
	give_technology = { message = no tech = tech_alloys_2 }
	give_technology = { message = no tech = tech_luxuries_2 }
	give_technology = { message = no tech = tech_afterburners_2 }
	give_technology = { message = no tech = tech_housing_2 }
	give_technology = { message = no tech = tech_mine_living_metal }
	give_technology = { message = no tech = tech_mass_drivers_4 }
	give_technology = { message = no tech = tech_missiles_4 }
}

give_society_tech_tier_1_effect = {
	if = {
		limit = {
			is_regular_empire = yes
		}
		give_technology = { message = no tech = tech_space_trading }
	}
	give_technology = { message = no tech = tech_eco_simulation }
	give_technology = { message = no tech = tech_hydroponics }
	give_technology = { message = no tech = tech_food_processing_1 }
	give_technology = { message = no tech = tech_society_1 }
	if = {
		limit = {
			is_regular_empire = yes
		}
		give_technology = { message = no tech = tech_alien_life_studies }
	}
	if = {
		limit = {
			is_regular_empire = yes
		}
		give_technology = { message = no tech = tech_frontier_health }
	}
	give_technology = { message = no tech = tech_dense_jungle }
	give_technology = { message = no tech = tech_quicksand_basin }
	give_technology = { message = no tech = tech_noxious_swamp }
	give_technology = { message = no tech = tech_massive_glacier }
	give_technology = { message = no tech = tech_toxic_kelp }
	give_technology = { message = no tech = tech_deep_sinkhole }
	if = {
		limit = {
			OR = {
				NOT = { has_authority = auth_machine_intelligence }
				has_civic = civic_machine_assimilator
				has_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_genome_mapping }
	}
	give_technology = { message = no tech = tech_ground_defense_planning }
	give_technology = { message = no tech = tech_planetary_unification }
	give_technology = { message = no tech = tech_adaptive_bureaucracy }
	if = {
		limit = {
			is_regular_empire = yes
		}
		give_technology = { message = no tech = tech_neural_implants }
	}
	if = {
		limit = {
			is_gestalt = no
		}
		give_technology = { message = no tech = tech_hyper_entertainment_forum }
	}
	if = {
		limit = {
			NOR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_valid_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_heritage_site }
	}
}

give_society_tech_tier_2_effect = {
	give_technology = { message = no tech = tech_gene_crops }
	give_technology = { message = no tech = tech_society_2 }
	give_technology = { message = no tech = tech_arcane_deciphering }
	if = {
		limit = {
			OR = {
				is_machine_empire = no
				has_civic = civic_machine_assimilator
				has_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_colonization_2 }
	}
	if = {
		limit = {
			OR = {
				is_machine_empire = no
				has_civic = civic_machine_assimilator
				has_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_colonization_3 }
	}
	if = {
		limit = {
			is_gestalt = no
		}
		give_technology = { message = no tech = tech_frontier_hospital }
	}
	give_technology = { message = no tech = tech_mountain_range }
	give_technology = { message = no tech = tech_volcano }
	give_technology = { message = no tech = tech_dangerous_wildlife }
	give_technology = { message = no tech = tech_terrestrial_sculpting }
	if = {
		limit = {
			OR = {
				NOT = { has_authority = auth_machine_intelligence }
				has_civic = civic_machine_assimilator
			}
		}
		give_technology = { message = no tech = tech_vitality_boosters }
	}
	if = {
		limit = {
			NOT = {
				has_valid_civic = civic_fanatic_purifiers
				#has_valid_civic = civic_machine_terminator # covered by not being machine
				#has_valid_civic = civic_hive_devouring_swarm # can uplift to make delicious
			}
			OR = {
				NOT = { has_authority = auth_machine_intelligence }
				has_civic = civic_machine_assimilator
				has_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_epigenetic_triggers }
	}
	if = {
		limit = {
			OR = {
				NOT = { has_authority = auth_machine_intelligence }
				has_civic = civic_machine_assimilator
			}
		}
		give_technology = { message = no tech = tech_cloning }
	}
	if = {
		limit = {
			OR = {
				NOT = { has_authority = auth_machine_intelligence }
				has_civic = civic_machine_assimilator
			}
		}
		give_technology = { message = no tech = tech_gene_banks }
	}
	give_technology = { message = no tech = tech_doctrine_fleet_size_1 }
	give_technology = { message = no tech = tech_doctrine_fleet_size_2 }
	give_technology = { message = no tech = tech_interstellar_fleet_traditions }
	give_technology = { message = no tech = tech_doctrine_navy_size_1 }
	give_technology = { message = no tech = tech_centralized_command }
	give_technology = { message = no tech = tech_global_defense_grid }
	give_technology = { message = no tech = tech_galactic_ambitions }
	give_technology = { message = no tech = tech_interstellar_campaigns }
	give_technology = { message = no tech = tech_colonial_centralization }
	give_technology = { message = no tech = tech_planetary_infrastructure_1 }
	if = {
		limit = {
			NOT = { has_ethic = ethic_gestalt_consciousness	}
		}
		give_technology = { message = no tech = tech_subdermal_stimulation }
	}
	give_technology = { message = no tech = tech_effective_bureaucracy }
	give_technology = { message = no tech = tech_colonial_bureaucracy }
	if = {
		limit = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		give_technology = { message = no tech = tech_living_state }
	}
	if = {
		limit = {
			has_ethic = ethic_gestalt_consciousness
		}
		give_technology = { message = no tech = tech_autonomous_agents }
	}
	if = {
		limit = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		give_technology = { message = no tech = tech_artificial_moral_codes }
	}
	if = {
		limit = {
			is_gestalt = yes
		}
		give_technology = { message = no tech = tech_unity_of_purpose }
	}
	if = {
		limit = {
			has_ethic = ethic_gestalt_consciousness
		}
		give_technology = { message = no tech = tech_holographic_rituals }
	}
	if = {
		limit = {
			is_hive_empire = yes
		}
		give_technology = { message = no tech = tech_hive_cluster }
	}
	if = {
		limit = {
			is_gestalt = no
		}
		give_technology = { message = no tech = tech_slave_colonies }
	}
	if = {
		limit = {
			is_regular_empire = yes
		}
		give_technology = { message = no tech = tech_xeno_diplomacy }
	}
	give_technology = { message = no tech = tech_capital_productivity_1 }
}

give_society_tech_tier_3_effect = {
	if = {
		limit = {
			is_gestalt = no
		}
		give_technology = { message = no tech = tech_interstellar_economics }
	}
	give_technology = { message = no tech = tech_nano_vitality_crops }
	give_technology = { message = no tech = tech_food_processing_2 }
	give_technology = { message = no tech = tech_gene_tailoring }
	give_technology = { message = no tech = tech_refit_standards }
	give_technology = { message = no tech = tech_combat_training }
	give_technology = { message = no tech = tech_psionic_theory }
	give_technology = { message = no tech = tech_galactic_bureaucracy }
	if = {
		limit = {
			has_authority = auth_machine_intelligence
		}
		give_technology = { message = no tech = tech_resource_processing_algorithms }
	}
	if = {
		limit = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_paradise_dome }
	}
	if = {
		limit = {
			NOR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_valid_civic = civic_machine_servitor
			}
		}
		give_technology = { message = no tech = tech_autocurating_vault }
	}
	if = {
		limit = {
			has_valid_civic = civic_agrarian_idyll
		}
		give_technology = { message = no tech = tech_housing_agrarian_idyll }
	}
}