set_merchant_government_effect = {
	if = {
		limit = {
			has_technology = tech_galactic_administration
		}
		change_government = {
			authority = auth_oligarchic
			cooldown = no
			remove_invalid_civics = yes
			civics = {
				civic = civic_merchant_guilds
				civic = random
				civic = random
				civic = random
			}
		}
	}
	else = {
		change_government = {
			authority = auth_oligarchic
			cooldown = no
			remove_invalid_civics = yes
			civics = {
				civic = civic_merchant_guilds
				civic = random
				civic = random
			}
		}
	}
}

implement_human_rights_effect = {
	copy_ethos_and_authority = root
	if = {
		limit = {
			has_civic = civic_galactic_sovereign
		}
		force_remove_civic = civic_galactic_sovereign
	}
	if = {
		limit = {
			has_civic = civic_galactic_sovereign_megacorp
		}
		force_remove_civic = civic_galactic_sovereign_megacorp
	}
	if = {
		limit = {
			has_civic = civic_psionic_sovereign
		}
		force_remove_civic = civic_psionic_sovereign
	}
	if = {
		limit = {
			root = { has_authority = auth_corporate }
			has_authority = auth_corporate
		}
		set_merchant_government_effect = yes
	}
	add_modifier = { modifier = recently_human_right_implemented days = 3650 }
	add_opinion_modifier = { modifier = opinion_liberated_us who = root }
	root = {
		add_opinion_modifier = { modifier = opinion_we_liberated who = from }
	}
}

ECI_shift_ethic = {
	if = {
		limit = {
			has_theme_civics = no
		}
		shift_ethic = ethic_$ETHIC$
	}
	else = {
		ordered_pop_faction = {
			limit = {
				is_no_fanatic_government_faction = yes
				NOT = { is_same_value = event_target:TargetFaction }
			}
			order_by = negative_support
			position = 0
			remove_ethic_of_faction = yes
		}
		if = {
			limit = {
				has_ethic = ethic_$ETHIC$
			}
			country_remove_ethic = ethic_$ETHIC$
			country_add_ethic = ethic_fanatic_$ETHIC$
		}
		else = {
			country_add_ethic = ethic_$ETHIC$
		}
	}
}

remove_ethic_of_faction = {
	if = {
		limit = {
			OR = {
				is_pop_faction_type = progressive
				is_pop_faction_type = entrepreneurs
				is_pop_faction_type = manifesti
			}
		}
		owner = {
			country_remove_ethic = ethic_egalitarian
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = totalitarian
				is_pop_faction_type = civil_official
			}
		}
		owner = {
			country_remove_ethic = ethic_authoritarian
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = socialists
				is_pop_faction_type = pioneer
			}
		}
		owner = {
			country_remove_ethic = ethic_socialism
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = industrialist
				is_pop_faction_type = bankers
			}
		}
		owner = {
			country_remove_ethic = ethic_capitalism
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = technologist
				is_pop_faction_type = competitors
			}
		}
		owner = {
			country_remove_ethic = ethic_materialist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = secular
				is_pop_faction_type = traditionalist
			}
		}
		owner = {
			country_remove_ethic = ethic_spiritualist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = proletarians
				is_pop_faction_type = xenoist
			}
		}
		owner = {
			country_remove_ethic = ethic_xenophile
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = isolationist
				is_pop_faction_type = supremacist
			}
		}
		owner = {
			country_remove_ethic = ethic_xenophobe
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = revolutionary
				is_pop_faction_type = imperialist
			}
		}
		owner = {
			country_remove_ethic = ethic_pacifist
		}
	}
	if = {
		limit = {
			OR = {
				is_pop_faction_type = revolutionary
				is_pop_faction_type = imperialist
			}
		}
		owner = {
			country_remove_ethic = ethic_militarist
		}
	}
	if = {
		limit = {
			is_pop_faction_type = environmentalists
		}
		owner = {
			country_remove_ethic = ethic_green
		}
	}
	if = {
		limit = {
			is_pop_faction_type = manufacturers
		}
		owner = {
			country_remove_ethic = ethic_industrial
		}
	}
}

kill_one_owner_species_pop = {
	while = {
		count = 1
		random_owned_pop = {
			limit = {
				is_same_species = root.owner.species
			}
			kill_pop = yes
		}
	}
}

build_bureaucratic_building = {
	if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				free_building_slots > 0
			}
			owner = {
				is_regular_empire = yes
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		add_building = building_bureaucratic_1
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				free_building_slots = 0
				has_building = building_bureaucratic_1
			}
			owner = {
				is_regular_empire = yes
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_bureaucratic_1
		add_building = building_bureaucratic_2
	}
	else_if = {
		limit = {
			planet = {
				allow_bureaucratic_building = yes
				free_building_slots = 0
				has_building = building_bureaucratic_2
				NOT = { has_building = building_bureaucratic_1 }
			}
			owner = {
				is_regular_empire = yes
				OR = {
					is_adminless_country = no
					is_clean_government_country = yes
				}
			}
		}
		remove_building = building_bureaucratic_2
		add_building = building_bureaucratic_3
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				num_buildings = { TYPE = building_planet_network_node value < 7 }
			}
			owner = {
				has_valid_civic = civic_OGAS
				NOT = { has_technology = tech_sapient_ai }
			}
		}
		add_building = building_planet_network_node
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				NOT = { has_building = building_planet_network_node }
				num_buildings = { TYPE = building_planetary_management_center value < 7 }
			}
			owner = {
				has_valid_civic = civic_OGAS
				has_technology = tech_sapient_ai
			}
		}
		add_building = building_planetary_management_center
	}
	else_if = {
		limit = {
			planet = {
				has_building = building_planet_network_node
			}
			owner = {
				has_valid_civic = civic_OGAS
				has_technology = tech_sapient_ai
			}
		}
		remove_building = building_planet_network_node
		add_building = building_planetary_management_center
	}
	else_if = {
		limit = {
			planet = {
				free_building_slots > 0
				NOT = { has_building = building_information_tower }
			}
			owner = {
				OR = {
					has_valid_civic = civic_cybercap
					has_valid_civic = civic_corporate_cybercap
				}
			}
		}
		add_building = building_information_tower
	}
}

spawn_god_habitat = {
	spawn_planet = {
		class = "pc_habitat"
		location = event_target:spawn_god_ship_planet
		orbit_location = yes
		orbit_angle_offset = 45
		orbit_distance_offset = 9.899
		size = 10
		has_ring = no

		init_effect = {
			set_name = "NAME_Payback_Warship_GOD"
			set_planet_entity = {
				entity = "fc_01_evil_slaver_hab_entity"
			}
			set_surveyed = {
				surveyed = yes
				surveyor = FROM
			}
			set_all_comms_surveyed = yes
			clear_blockers = yes

			set_planet_flag = megastructure
			set_planet_flag = habitat
			set_planet_flag = advanced_habitat
			set_planet_flag = advanced_habitat_2
			set_planet_flag = payback_habitat
			set_planet_flag = research_habitat

			add_deposit = d_god_habitat_research
		}
	}
}

