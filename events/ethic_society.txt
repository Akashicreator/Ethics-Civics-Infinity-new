namespace=ethic_society

country_event = { # 社会状态更新（国家月检）
    id = ethic_society.0
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		export_trigger_value_to_variable = {
			trigger = count_owned_ship
			parameters = {
				limit = {
					OR = {
						is_ship_size = science
						is_ship_size = explorer_vessel
						is_ship_size = alien_racing_ship
						is_ship_size = ghost_ship
						is_ship_size = enigmatic_cache
						is_ship_size = azaryn_dome
					}
				}
			}
			variable = num_owned_science_ship
		}
		every_owned_planet = {
			if = {
				limit = {
					AND = {
						is_colony = yes
						is_under_colonization = no
					}
				}
				planet_event = { id = ethic_society.1 }
			}
		}

		# 通货膨胀buff
		set_variable = { which = society_trade_value_target_country value = value:society_trade_value_target }
		if = {
			limit = {
				owner = { is_market_type = yes }
				check_variable = { which = society_trade_value_target_country value >= 1 }
			}
			remove_modifier = trade_value_reduction_modifier_2
			add_modifier = {
				modifier = trade_value_reduction_modifier
				multiplier = 1
				clear_on_owner_change = yes
			}
		}
		if = {
			limit = {
				owner = { is_market_type = yes }
				check_variable = { which = society_trade_value_target_country value > 0 }
				check_variable = { which = society_trade_value_target_country value < 1 }
			}
			remove_modifier = trade_value_reduction_modifier_2
			add_modifier = {
				modifier = trade_value_reduction_modifier
				multiplier = society_trade_value_target_country
				clear_on_owner_change = yes
			}
		}
		if = {
			limit = {
				owner = { is_market_type = yes }
				check_variable = { which = society_trade_value_target_country value > -1 }
				check_variable = { which = society_trade_value_target_country value < 0 }
			}
			remove_modifier = trade_value_reduction_modifier
			add_modifier = {
				modifier = trade_value_reduction_modifier_2
				multiplier = society_trade_value_target_country
				clear_on_owner_change = yes
			}
		}
		if = {
			limit = {
				owner = { is_market_type = yes }
				check_variable = { which = society_trade_value_target_country value <= -1 }
			}
			remove_modifier = trade_value_reduction_modifier
			add_modifier = {
				modifier = trade_value_reduction_modifier_2
				multiplier = -100
				clear_on_owner_change = yes
			}
		}
		if = {
			limit = {
				owner = { is_market_type = no }
			}
			remove_modifier = trade_value_reduction_modifier
			remove_modifier = trade_value_reduction_modifier_2
		}
    }
}

planet_event = { # 社会状态更新（星球月检与触发）
	id = ethic_society.1
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		
		if = {
			limit = { NOT = { has_deposit = d_ethic_society } }
			add_deposit = d_ethic_society
		}

    }
}

country_event = { # 解除动员状态
	id = ethic_society.2
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		is_at_war = no
		has_crisis = no
		any_owned_planet = {
			has_modifier = modifier_mobilization
		}
	}
	immediate = {
		every_owned_planet = {
			remove_modifier = modifier_mobilization
		}
		every_owned_pop = {
			remove_modifier = modifier_mobilization_pop_1
			remove_modifier = modifier_mobilization_pop_2
			remove_modifier = modifier_mobilization_pop_3
			remove_modifier = modifier_mobilization_pop_4
		}
		every_owned_army = {
			limit = {
				OR = {
					army_type = conscript_army
					army_type = robotic_conscript_army
					army_type = robotic_conscript_army_2
					army_type = robotic_conscript_army_3
					army_type = psionic_conscript_army
					army_type = clone_conscript_army
					army_type = undead_conscript_army
					army_type = slave_conscript_army
					army_type = thrall_conscript_army
				}
			}
			leader = {
				unassign_leader = this
			}
			remove_army = yes
		}
	}
}

planet_event = {
	id = ethic_society.3
	title = ethic_society.3.name
	diplomatic = yes
	picture_event_data = {
		portrait = root.owner
		room = mercenary_enclave_room
	}

	is_triggered_only = yes

	desc = enclave.270.desc

	#Discuss another matter (return to menu)
	option = {
		name = enclave.215.a
	}

	# Small Army
	option = {
		name = enclave.270.a
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 600 }
			}
		}
		owner = {
			add_resource = { energy = -600  }
		}
		custom_tooltip = small_merc_army_hire
		add_modifier = {
			modifier = modifier_mercenaries
			days = 3600
		}
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = root.owner
					while = {
						count = 5
						create_army_transport = {
							army_type = "mercenary_army"
							army_name = "NAME_military_contractors"
							species = event_target:mercenary_enclave_species
						}
					}
					set_location = {
						target = root
					}
				}
			}
		}
	}

	# Small Mecha Army
	option = {
		name = enclave.270.b
		trigger = {
			has_major_upgraded_capital = yes
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1200 }
			}
		}
		owner = {
			add_resource = { energy = -1200 }
		}
		custom_tooltip = small_mecha_merc_army_hire
		add_modifier = {
			modifier = modifier_mercenaries
			days = 3600
		}
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = root.owner
					while = {
						count = 5
						create_army_transport = {
							army_type = "mecha_army"
							army_name = "NAME_mechawarrior_contractors"
							species = event_target:mercenary_enclave_species
						}
					}
					set_location = {
						target = root
					}
				}
			}
		}
	}

	# Medium Army
	option = {
		name = enclave.270.c
		trigger = {
			has_major_upgraded_capital = yes
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1100 }
			}
		}
		owner = {
			add_resource = { energy = -1100 }
		}
		custom_tooltip = medium_merc_army_hire
		add_modifier = {
			modifier = modifier_mercenaries
			days = 3600
		}
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = root.owner
					while = {
						count = 10
						create_army_transport = {
							army_type = "mercenary_army"
							army_name = "NAME_military_contractors"
							species = event_target:mercenary_enclave_species
						}
					}
					set_location = {
						target = root
					}
				}
			}
		}
	}

	# Medium Mecha Army
	option = {
		name = enclave.270.d
		trigger = {
			has_fully_upgraded_capital = yes
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 2300 }
			}
		}
		owner = {
			add_resource = { energy = -2300 }
		}
		custom_tooltip = medium_mecha_merc_army_hire
		add_modifier = {
			modifier = modifier_mercenaries
			days = 3600
		}
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = root.owner
					while = {
						count = 10
						create_army_transport = {
							army_type = "mecha_army"
							army_name = "NAME_mechawarrior_contractors"
							species = event_target:mercenary_enclave_species
						}
					}
					set_location = {
						target = root
					}
				}
			}
		}
	}

	# Large Army
	option = {
		name = enclave.270.e
		trigger = {
			has_fully_upgraded_capital = yes
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 2000 }
			}
		}
		owner = {
			add_resource = { energy = -2000 }
		}
		custom_tooltip = large_merc_army_hire
		add_modifier = {
			modifier = modifier_mercenaries
			days = 3600
		}
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = root.owner
					while = {
						count = 15
						create_army_transport = {
							army_type = "mercenary_army"
							army_name = "NAME_military_contractors"
							species =event_target:mercenary_enclave_species
						}
					}
					set_location = {
						target = root
					}
				}
			}
		}
	}
}